# 🎯 专注功能使用指南

## 功能概述

专注功能是桌面助手的核心功能，帮助用户保持专注状态。通过AI分析屏幕内容，实时监控用户是否专注于设定的目标任务。

## 主要特性

### ✨ 核心功能
- **目标设定**: 用户可以设定具体的专注目标
- **时间管理**: 支持自定义专注时长（1-180分钟）
- **智能监控**: 每10秒自动截图并分析专注度
- **实时反馈**: 根据专注度实时切换表情和提供建议
- **暂停恢复**: 支持暂停和恢复专注会话
- **完成报告**: 专注结束后显示详细统计报告

### 🤖 AI分析
- **视觉识别**: 使用视觉模型描述屏幕内容
- **专注评估**: 使用语言模型分析是否符合目标
- **智能反馈**: 根据分析结果提供个性化建议
- **表情变化**: 专注度高时显示🔥，分心时显示😴

## 使用方法

### 开始专注
1. 右键点击桌面助手
2. 选择 "🎯 开始专注"
3. 在配置对话框中：
   - 输入专注目标（如"完成项目报告"）
   - 设置专注时长（默认25分钟）
   - 调整高级设置（可选）
4. 点击 "🚀 开始专注"

### 专注过程中
- **查看状态**: 左键点击查看当前专注状态
- **暂停/恢复**: 右键菜单选择暂停或恢复
- **提前结束**: 右键菜单选择结束专注
- **实时反馈**: 观察表情和偶尔出现的提示气泡

### 完成专注
- 时间到达后自动显示完成庆祝
- 查看专注报告（专注时长、专注度等）
- 选择是否开始新的专注会话

## 配置说明

### 基础设置
- **专注目标**: 描述你要专注的具体任务
- **专注时长**: 1-180分钟，推荐25分钟（番茄工作法）

### 高级设置
- **分析频率**: 5-60秒，默认10秒
- **专注度阈值**: 50-95%，默认70%
- **AI模型配置**: 在设置中配置视觉和语言模型

## 技术架构

### 核心组件
```
专注功能架构
├── FocusState (专注状态)
│   ├── 定时截图和分析
│   ├── 用户交互处理
│   └── 状态管理
├── FocusConfigDialog (配置对话框)
│   ├── 目标设置
│   ├── 时间选择
│   └── 高级选项
├── ScreenshotManager (截图管理器)
│   ├── 跨平台截图
│   ├── 图像压缩
│   └── 文件管理
├── FocusAnalyzer (AI分析器)
│   ├── 视觉模型调用
│   ├── 语言模型分析
│   └── 结果处理
└── FocusSessionManager (会话管理)
    ├── 会话数据
    ├── 统计分析
    └── 历史记录
```

### 工作流程
1. **用户发起**: 右键菜单 → 专注配置 → 开始专注
2. **状态切换**: 正常状态 → 专注状态
3. **定时监控**: 10秒定时器 → 截图 → AI分析 → 反馈更新
4. **完成处理**: 时间到达 → 生成报告 → 切换回正常状态

## 依赖要求

### Python包
```
PySide6>=6.4.0      # GUI框架
Pillow>=9.0.0       # 图像处理
openai>=1.0.0       # AI模型调用
```

### AI模型
- **视觉模型**: 支持图像理解的多模态模型
- **语言模型**: 支持文本分析的语言模型
- **兼容性**: 支持OpenAI API兼容的本地模型

## 配置示例

### config.json 配置
```json
{
  "focus": {
    "default_duration": 25,
    "analysis_interval": 10,
    "screenshot_quality": 0.7,
    "focus_threshold": 0.7,
    "enable_notifications": true,
    "save_screenshots": false,
    "max_session_history": 10
  },
  "vision_model": {
    "base_url": "http://localhost:1234/v1",
    "model_name": "llava-1.5-7b-hf",
    "api_key": ""
  },
  "language_model": {
    "base_url": "http://localhost:1234/v1", 
    "model_name": "qwen2.5-7b-instruct",
    "api_key": ""
  }
}
```

## 故障排除

### 常见问题

#### 1. 截图失败
- **检查权限**: macOS需要屏幕录制权限
- **检查依赖**: 确保Pillow正确安装
- **检查显示器**: 确保有可用的显示设备

#### 2. AI分析失败
- **检查配置**: 确保AI模型URL和名称正确
- **检查网络**: 确保能访问AI服务
- **降级模式**: 没有AI时会使用模拟分析

#### 3. 性能问题
- **调整频率**: 增加分析间隔时间
- **降低质量**: 减少截图质量设置
- **清理文件**: 定期清理临时截图文件

### 调试模式
```bash
# 启用详细日志
export PYTHONPATH=.
export LOG_LEVEL=DEBUG

# 保存截图用于调试
# 在config.json中设置: "save_screenshots": true

# 运行测试脚本
python scripts/test_focus_feature.py
```

## 未来扩展

### 计划功能
- **专注报告导出**: 支持导出详细的专注分析报告
- **专注历史**: 查看历史专注会话和趋势
- **自定义规则**: 允许用户自定义专注度判断规则
- **多显示器支持**: 支持多显示器环境的智能截图
- **专注音乐**: 集成专注背景音乐播放

### 扩展接口
- **插件系统**: 支持第三方专注插件
- **API接口**: 提供REST API供其他应用调用
- **数据导出**: 支持多种格式的数据导出

## 开发指南

### 添加新的反馈类型
1. 在 `FocusAnalyzer` 中添加新的反馈模板
2. 在 `emoji_mapping` 中添加对应表情
3. 在分析逻辑中添加新的评分区间

### 自定义分析算法
1. 继承 `FocusAnalyzer` 类
2. 重写 `analyze_focus` 方法
3. 在 `FocusState` 中替换分析器实例

### 添加新的配置选项
1. 在 `config.py` 中添加默认配置
2. 在 `FocusConfigDialog` 中添加UI控件
3. 在相关组件中读取和使用配置

---

*本文档会随着功能更新而持续完善*